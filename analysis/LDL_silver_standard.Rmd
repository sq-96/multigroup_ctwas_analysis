---
title: "LDL analysis after postprocessing"
author: "XSun"
date: "2025-01-05"
output:
  workflowr::wflow_html:
    code_folding: hide
    toc: true
---

# Introduction

We used the LDL genes reported by multi-group analysis after postprocess to do some downstream analysiss.


```{r warning=F, message=F}
library(ctwas)
library(dplyr)
library(EnsDb.Hsapiens.v86)
library(pheatmap)
library(ggplot2)
library(VennDiagram)
ens_db <- EnsDb.Hsapiens.v86

mapping_predictdb <- readRDS("/project2/xinhe/shared_data/multigroup_ctwas/weights/mapping_files/PredictDB_mapping.RDS")
mapping_munro <- readRDS("/project2/xinhe/shared_data/multigroup_ctwas/weights/mapping_files/Munro_mapping.RDS")
mapping_two <- rbind(mapping_predictdb,mapping_munro)


plot_heatmap_byomics <- function(heatmap_data, main) {

  rownames(heatmap_data) <- heatmap_data$gene_name
  heatmap_data <- heatmap_data %>% dplyr::select(-gene_name, -combined_pip)

  if(nrow(heatmap_data) ==1){

    heatmap_data <- rbind(heatmap_data,rep(0,ncol(heatmap_data)))
    rownames(heatmap_data)[2] <- "fake_gene_for_plotting"

  }

  heatmap_matrix <- as.matrix(heatmap_data)

  p <- pheatmap(heatmap_matrix,
                cluster_rows = F,   # Cluster the rows (genes)
                cluster_cols = F,   # Cluster the columns (QTL types)
                color = colorRampPalette(c("white", "red"))(50), # Color gradient
                display_numbers = TRUE, # Display numbers in cells
                main = main,labels_row = rownames(heatmap_data), silent = T)

  return(p)
}

plot_heatmap_bytissue <- function(heatmap_data, main, tissues) {
  
  rownames(heatmap_data) <- heatmap_data$gene_name
  heatmap_data <- heatmap_data %>% dplyr::select(-gene_name, -combined_pip)
  
  pip_types <- c("|eQTL_pip", "|sQTL_pip", "|stQTL_pip")

  combinations <- expand.grid(pip_types, tissues)
  order <- paste0(combinations$Var2, combinations$Var1)
  
  heatmap_data <- heatmap_data[,order]
  
  if(nrow(heatmap_data) ==1){
    
    heatmap_data <- rbind(heatmap_data,rep(0,ncol(heatmap_data)))
    rownames(heatmap_data)[2] <- "fake_gene_for_plotting"
    
  }
  
  heatmap_matrix <- as.matrix(heatmap_data)
  
  p <- pheatmap(heatmap_matrix,
                cluster_rows = F,   # Cluster the rows (genes)
                cluster_cols = F,   # Cluster the columns (QTL types)
                color = colorRampPalette(c("white", "red"))(50), # Color gradient
                display_numbers = TRUE, # Display numbers in cells
                main = main,labels_row = rownames(heatmap_data), silent = T)
  
  return(p)
}


get_ctwas_file <- function(trait, tissue = NULL, folder_results) {
  # Build file paths
  if (is.null(tissue)) {
    file_ctwas_res_origin <- paste0(folder_results, "/", trait, "/", trait, ".finemap_regions_res.RDS")
    file_ctwas_res_regionmerge <- paste0(folder_results, "/", trait, "/", trait, ".regionmerge_finemap_regions_res.RDS")
    file_ctwas_res_ldmismatch <- paste0(folder_results, "/", trait, "/", trait, ".ldmismatch_finemap_regions_res.RDS")
  } else {
    file_ctwas_res_origin <- paste0(folder_results, "/", trait, "/", trait, "_", tissue, ".finemap_regions_res.RDS")
    file_ctwas_res_regionmerge <- paste0(folder_results, "/", trait, "/", trait, "_", tissue, ".regionmerge_finemap_regions_res.RDS")
    file_ctwas_res_ldmismatch <- paste0(folder_results, "/", trait, "/", trait, "_", tissue, ".ldmismatch_finemap_regions_res.RDS")
  }
  
  # Determine which file exists
  file_ctwas_result <- if (file.exists(file_ctwas_res_ldmismatch)) {
    file_ctwas_res_ldmismatch
  } else if (file.exists(file_ctwas_res_regionmerge)) {
    file_ctwas_res_regionmerge
  } else {
    file_ctwas_res_origin
  }
  
  return(file_ctwas_result)
}
```



# Fine-mapping results

## Single eQTL analysis results -- pre-estimate L

```{r warning=F, message=F}

trait <- "LDL-ukb-d-30780_irnt"
tissue <- "Liver"

folder_single_results <- "/project/xinhe/shengqian/single_tissue_screen/processed_weights/expression_weights/"

file_ctwas_result <- get_ctwas_file(trait, tissue, folder_single_results)

ctwas_res_single_post <- readRDS(file_ctwas_result)

z_gene_single <-readRDS(paste0(folder_single_results,"/",trait,"/",trait,"_",tissue,".z_gene.RDS"))

susie_alpha_res_single_post <- ctwas_res_single_post$susie_alpha_res
susie_alpha_res_single_post <- anno_susie_alpha_res(susie_alpha_res_single_post,
                                        mapping_table = mapping_two,
                                        map_by = "molecular_id",
                                        drop_unmapped = TRUE)

combined_pip_by_group_single <- combine_gene_pips(susie_alpha_res_single_post,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = TRUE,
                                             include_cs_id = F)
combined_pip_sig_single <- subset(combined_pip_by_group_single, combined_pip > 0.8)

DT::datatable(combined_pip_sig_single,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Genes with PIP > 0.8 in single eQTL analysis, cs filtered'),options = list(pageLength = 5) )


z_gene_single <- z_gene_single %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")


```

## Single eQTL analysis results -- L=5 -- eQTL, SNP different variance

```{r warning=F, message=F}

trait <- "LDL-ukb-d-30780_irnt"
tissue <- "Liver"

folder_single_results_L5 <- "/project/xinhe/shengqian/single_tissue_screen/processed_weights_L5/expression_weights"

file_ctwas_result_L5 <- get_ctwas_file(trait, tissue, folder_single_results_L5)

ctwas_res_single_post_L5 <- readRDS(file_ctwas_result_L5)

z_gene_single_L5 <-readRDS(paste0(folder_single_results_L5,"/",trait,"/",trait,"_",tissue,".z_gene.RDS"))

susie_alpha_res_single_post_L5 <- ctwas_res_single_post_L5$susie_alpha_res
susie_alpha_res_single_post_L5 <- anno_susie_alpha_res(susie_alpha_res_single_post_L5,
                                        mapping_table = mapping_two,
                                        map_by = "molecular_id",
                                        drop_unmapped = TRUE)

combined_pip_by_group_single_L5 <- combine_gene_pips(susie_alpha_res_single_post_L5,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = TRUE,
                                             include_cs_id = F)
combined_pip_sig_single_L5 <- subset(combined_pip_by_group_single_L5, combined_pip > 0.8)

DT::datatable(combined_pip_sig_single_L5,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Genes with PIP > 0.8 in single eQTL analysis, cs filtered'),options = list(pageLength = 5) )


z_gene_single_L5 <- z_gene_single_L5 %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")

```




## Single eQTL analysis results -- L=5 -- same variance

```{r warning=F, message=F}

trait <- "LDL-ukb-d-30780_irnt"
tissue <- "Liver"

folder_single_results_sharedvar_L5 <- "/project/xinhe/shengqian/single_tissue_screen/processed_weights_samevariance_L5/expression_weights/"

file_ctwas_result_sharedvar_L5 <- get_ctwas_file(trait, tissue, folder_single_results_sharedvar_L5)

ctwas_res_single_post_sharedvar_L5 <- readRDS(file_ctwas_result_sharedvar_L5)

z_gene_single_sharedvar_L5 <-readRDS(paste0(folder_single_results_sharedvar_L5,"/",trait,"/",trait,"_",tissue,".z_gene.RDS"))

susie_alpha_res_single_post_sharedvar_L5 <- ctwas_res_single_post_sharedvar_L5$susie_alpha_res
susie_alpha_res_single_post_sharedvar_L5 <- anno_susie_alpha_res(susie_alpha_res_single_post_sharedvar_L5,
                                        mapping_table = mapping_two,
                                        map_by = "molecular_id",
                                        drop_unmapped = TRUE)

combined_pip_by_group_single_sharedvar_L5 <- combine_gene_pips(susie_alpha_res_single_post_sharedvar_L5,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = TRUE,
                                             include_cs_id = F)
combined_pip_sig_single_sharedvar_L5 <- subset(combined_pip_by_group_single_sharedvar_L5, combined_pip > 0.8)

DT::datatable(combined_pip_sig_single_sharedvar_L5,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Genes with PIP > 0.8 in single eQTL analysis, cs filtered'),options = list(pageLength = 5) )


z_gene_single_sharedvar_L5 <- z_gene_single_sharedvar_L5 %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")

```




## Multi-group analysis results -- same QTL share variance, pre-estimate L

```{r warning=F, message=F}

tissues <- c("Liver","Spleen","Esophagus_Gastroesophageal_Junction","Esophagus_Muscularis","Esophagus_Mucosa")

folder_multi_results <- "/project/xinhe/shengqian/ctwas_GWAS_analysis/results/"

file_ctwas_result <- get_ctwas_file(trait, tissue = NULL, folder_multi_results)


ctwas_res_multi_post <- readRDS(file_ctwas_result)


susie_alpha_res_multi_post <- ctwas_res_multi_post$susie_alpha_res
susie_alpha_res_multi_post <- anno_susie_alpha_res(susie_alpha_res_multi_post,
                                        mapping_table = mapping_two,
                                        map_by = "molecular_id",
                                        drop_unmapped = TRUE)

combined_pip_by_group_multi <- combine_gene_pips(susie_alpha_res_multi_post,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = TRUE,
                                             include_cs_id = F)
combined_pip_sig_multi <- subset(combined_pip_by_group_multi, combined_pip > 0.8)

DT::datatable(combined_pip_sig_multi,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Genes with PIP > 0.8 in multi-group analysis, cs filtered'),options = list(pageLength = 5) )

z_gene_multi <- readRDS(paste0(folder_multi_results,"/",trait,"/",trait,".z_gene.RDS"))
z_gene_multi <- z_gene_multi %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")


```




## Multi-group analysis results -- same QTL share variance, L = 5

```{r warning=F, message=F}

tissues <- c("Liver","Spleen","Esophagus_Gastroesophageal_Junction","Esophagus_Muscularis","Esophagus_Mucosa")

folder_multi_results_L5 <- "/project/xinhe/shengqian/ctwas_GWAS_analysis/results_L5/"

file_ctwas_result_L5 <- get_ctwas_file(trait, tissue = NULL, folder_multi_results_L5)


ctwas_res_multi_post_L5 <- readRDS(file_ctwas_result_L5)


susie_alpha_res_multi_post_L5 <- ctwas_res_multi_post_L5$susie_alpha_res
susie_alpha_res_multi_post_L5 <- anno_susie_alpha_res(susie_alpha_res_multi_post_L5,
                                        mapping_table = mapping_two,
                                        map_by = "molecular_id",
                                        drop_unmapped = TRUE)

combined_pip_by_group_multi_L5 <- combine_gene_pips(susie_alpha_res_multi_post_L5,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = TRUE,
                                             include_cs_id = F)
combined_pip_sig_multi_L5 <- subset(combined_pip_by_group_multi_L5, combined_pip > 0.8)

DT::datatable(combined_pip_sig_multi_L5,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Genes with PIP > 0.8 in multi-group analysis, cs filtered'),options = list(pageLength = 5) )

z_gene_multi_L5 <- readRDS(paste0(folder_multi_results_L5,"/",trait,"/",trait,".z_gene.RDS"))
z_gene_multi_L5 <- z_gene_multi_L5 %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")


```




## Multi-group analysis results -- all group share variance, pre-estimate L

```{r warning=F, message=F}

tissues <- c("Liver","Spleen","Esophagus_Gastroesophageal_Junction","Esophagus_Muscularis","Esophagus_Mucosa")

folder_multi_results_samevar <- "/project/xinhe/shengqian/ctwas_GWAS_analysis/results_same_variance/"


file_ctwas_result_samevar <- get_ctwas_file(trait, tissue = NULL, folder_multi_results_samevar)


ctwas_res_multi_post_samevar <- readRDS(file_ctwas_result_samevar)


susie_alpha_res_multi_post_samevar <- ctwas_res_multi_post_samevar$susie_alpha_res
susie_alpha_res_multi_post_samevar <- anno_susie_alpha_res(susie_alpha_res_multi_post_samevar,
                                        mapping_table = mapping_two,
                                        map_by = "molecular_id",
                                        drop_unmapped = TRUE)

combined_pip_by_group_multi_samevar <- combine_gene_pips(susie_alpha_res_multi_post_samevar,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = TRUE,
                                             include_cs_id = F)
combined_pip_sig_multi_samevar <- subset(combined_pip_by_group_multi_samevar, combined_pip > 0.8)

DT::datatable(combined_pip_sig_multi_samevar,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Genes with PIP > 0.8 in multi-group analysis, cs filtered'),options = list(pageLength = 5) )

z_gene_multi_samevar <- readRDS(paste0(folder_multi_results_samevar,"/",trait,"/",trait,".z_gene.RDS"))
z_gene_multi_samevar <- z_gene_multi_samevar %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")


```





## Multi-group analysis results -- all group share variance, L = 5

```{r warning=F, message=F}

tissues <- c("Liver","Spleen","Esophagus_Gastroesophageal_Junction","Esophagus_Muscularis","Esophagus_Mucosa")

folder_multi_results_samevar_L5 <- "/project/xinhe/shengqian/ctwas_GWAS_analysis/results_same_variance_L5/"

file_ctwas_result_samevar_L5 <- get_ctwas_file(trait, tissue = NULL, folder_multi_results_samevar_L5)


ctwas_res_multi_post_samevar_L5 <- readRDS(file_ctwas_result_samevar_L5)


susie_alpha_res_multi_post_samevar_L5 <- ctwas_res_multi_post_samevar_L5$susie_alpha_res
susie_alpha_res_multi_post_samevar_L5 <- anno_susie_alpha_res(susie_alpha_res_multi_post_samevar_L5,
                                        mapping_table = mapping_two,
                                        map_by = "molecular_id",
                                        drop_unmapped = TRUE)

combined_pip_by_group_multi_samevar_L5 <- combine_gene_pips(susie_alpha_res_multi_post_samevar_L5,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = TRUE,
                                             include_cs_id = F)
combined_pip_sig_multi_samevar_L5 <- subset(combined_pip_by_group_multi_samevar_L5, combined_pip > 0.8)

DT::datatable(combined_pip_sig_multi_samevar_L5,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Genes with PIP > 0.8 in multi-group analysis, cs filtered'),options = list(pageLength = 5) )

z_gene_multi_samevar_L5 <- readRDS(paste0(folder_multi_results_samevar_L5,"/",trait,"/",trait,".z_gene.RDS"))
z_gene_multi_samevar_L5 <- z_gene_multi_samevar_L5 %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")


```






# Comparing with silver standard genes

We followed the analysis in ctwas paper. The silver standard genes for LDL are:

```{r warning=F, message=F}
LDL_silver <- readxl::read_excel("/project/xinhe/xsun/multi_group_ctwas/data/LDL_silver.xlsx")
LDL_silver_known <- LDL_silver[LDL_silver$annotation == "known",]
LDL_silver_bystand <- LDL_silver[LDL_silver$annotation != "known",]

DT::datatable(LDL_silver,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','The silver standard genes for LDL (from ctwas paper, table S2)'),options = list(pageLength = 5) )
```


```{r warning=F, message=F}

stats <- data.frame(
                    analysis = c("ctwas paper",
                                 "ctwasV2 - single eQTL - eQTL,SNP different variance, preL",
                                 "ctwasV2 - single eQTL - eQTL,SNP different variance - L=5",
                                 "ctwasV2 - single eQTL - eQTL,SNP share variance - L=5",
                                 "ctwasV2 - multigroup - QTL share variance, preL",
                                 "ctwasV2 - multigroup - all share variance, preL",
                                 "ctwasV2 - multigroup - QTL share variance, L=5",
                                 "ctwasV2 - multigroup - all share variance, L=5"),
                    num_gene_pip08 = c(35,
                                       nrow(combined_pip_sig_single),
                                       nrow(combined_pip_sig_single_L5),
                                       nrow(combined_pip_sig_single_sharedvar_L5),
                                       nrow(combined_pip_sig_multi),
                                       nrow(combined_pip_sig_multi_samevar),
                                       nrow(combined_pip_sig_multi_L5),
                                       nrow(combined_pip_sig_multi_samevar_L5)),
                    num_gene_known_imputable = c("46 of 69 known",
                                                 sum(LDL_silver_known$genename %in% z_gene_single$gene_name),
                                                 sum(LDL_silver_known$genename %in% z_gene_single_L5$gene_name),
                                                 sum(LDL_silver_known$genename %in% z_gene_single_sharedvar_L5$gene_name),
                                                 sum(LDL_silver_known$genename %in% z_gene_multi$gene_name),
                                                 sum(LDL_silver_known$genename %in% z_gene_multi_samevar$gene_name),
                                                 sum(LDL_silver_known$genename %in% z_gene_multi_L5$gene_name),
                                                 sum(LDL_silver_known$genename %in% z_gene_multi_samevar_L5$gene_name)),
                    num_gene_known_pip08 = c(6,
                                             sum(LDL_silver_known$genename %in% combined_pip_sig_single$gene_name),
                                             sum(LDL_silver_known$genename %in% combined_pip_sig_single_L5$gene_name),
                                             sum(LDL_silver_known$genename %in% combined_pip_sig_single_sharedvar_L5$gene_name),
                                             sum(LDL_silver_known$genename %in% combined_pip_sig_multi$gene_name),
                                             sum(LDL_silver_known$genename %in% combined_pip_sig_multi_samevar$gene_name),
                                             sum(LDL_silver_known$genename %in% combined_pip_sig_multi_L5$gene_name),
                                             sum(LDL_silver_known$genename %in% combined_pip_sig_multi_samevar_L5$gene_name)),
                   num_gene_bystander_imputable = c("539 of 539 bystander",
                                                    sum(LDL_silver_bystand$genename %in% z_gene_single$gene_name),
                                                    sum(LDL_silver_bystand$genename %in% z_gene_single_L5$gene_name),
                                                    sum(LDL_silver_bystand$genename %in% z_gene_single_sharedvar_L5$gene_name),
                                                    sum(LDL_silver_bystand$genename %in% z_gene_multi$gene_name),
                                                    sum(LDL_silver_bystand$genename %in% z_gene_multi_samevar$gene_name),
                                                    sum(LDL_silver_bystand$genename %in% z_gene_multi_L5$gene_name),
                                                    sum(LDL_silver_bystand$genename %in% z_gene_multi_samevar_L5$gene_name)),
                    num_gene_bystander_pip08 = c(2,
                                                 sum(LDL_silver_bystand$genename %in% combined_pip_sig_single$gene_name),
                                                 sum(LDL_silver_bystand$genename %in% combined_pip_sig_single_L5$gene_name),
                                                 sum(LDL_silver_bystand$genename %in% combined_pip_sig_single_sharedvar_L5$gene_name),
                                                 sum(LDL_silver_bystand$genename %in% combined_pip_sig_multi$gene_name),
                                                 sum(LDL_silver_bystand$genename %in% combined_pip_sig_multi_samevar$gene_name),
                                                 sum(LDL_silver_bystand$genename %in% combined_pip_sig_multi_L5$gene_name),
                                                 sum(LDL_silver_bystand$genename %in% combined_pip_sig_multi_samevar_L5$gene_name))
                   )

stats$TP <- stats$num_gene_known_pip08 / (stats$num_gene_known_pip08 + stats$num_gene_bystander_pip08)

DT::datatable(stats,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;',''),options = list(pageLength = 10) )

```


## Checking why some silver standard genes are missed -- single eQTL, pre-estimate L

```{r warning=F, message=F, fig.height=20, fig.width=20}

LDL_silver_known_sig <- LDL_silver_known[as.numeric(LDL_silver_known$PIP) > 0.8 & LDL_silver_known$PIP !="NA",]
LDL_silver_known_sig <- LDL_silver_known_sig[,c("genename","cs_index","PIP","z","num_eqtl","region_tag")]

# check z_scores

z_gene_single <- readRDS(paste0(folder_single_results,"/",trait,"/",trait,"_",tissue,".z_gene.RDS"))

z_gene_single <- z_gene_single %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")
z_gene_single <- z_gene_single[,c("gene_name","z")]

z_gene_selected <- z_gene_single[z_gene_single$gene_name %in% LDL_silver_known_sig$genename,]

LDL_silver_known_sig <- merge(LDL_silver_known_sig,z_gene_selected, by.x ="genename", by.y = "gene_name",all.x=T)


# check pre-estimated L
screened_region_L <- readRDS(paste0(folder_single_results,"/",trait,"/",trait,"_",tissue,".screened_region_L.RDS"))
region_info <- readRDS("/project2/xinhe/shared_data/multigroup_ctwas/LD_region_info/region_info.RDS")

LDL_silver_known_sig$tag1 <- unlist(strsplit(LDL_silver_known_sig$region_tag,split = "_"))[seq(1,2*nrow(LDL_silver_known_sig), by =2)]
LDL_silver_known_sig$tag2 <- unlist(strsplit(LDL_silver_known_sig$region_tag,split = "_"))[seq(2,2*nrow(LDL_silver_known_sig), by =2)]
LDL_silver_known_sig$regionid <- ctwas:::convert_region_tags_to_region_id(region_info, LDL_silver_known_sig$tag1, LDL_silver_known_sig$tag2)
LDL_silver_known_sig$screened_region_L_newversion <- screened_region_L[LDL_silver_known_sig$regionid]

combined_pip_by_group_single_nocs <- combine_gene_pips(susie_alpha_res_single_post,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = F,
                                             include_cs_id = T)

LDL_silver_known_sig <- merge(LDL_silver_known_sig, combined_pip_by_group_single_nocs, by.x = "genename", by.y = "gene_name", all.x = T)

LDL_silver_known_sig <- LDL_silver_known_sig[,c("genename","cs_index","PIP","z.x","z.y","screened_region_L_newversion","combined_cs_id","combined_pip")]
colnames(LDL_silver_known_sig) <- c("genename","cs_index_old","PIP_old","z_old","z_new","screened_region_L_new","cs_id_new","PIP_new")

refinemap <- readRDS("/project/xinhe/xsun/multi_group_ctwas/13.post_processing_0103/results_other/ldl_silver_finemap_region.RDS")
LDL_silver_known_sig <- merge(LDL_silver_known_sig,refinemap, by.x = "genename", by.y = "gene_name", all.x=T)
LDL_silver_known_sig <- LDL_silver_known_sig[,1:ncol(LDL_silver_known_sig)-1]
colnames(LDL_silver_known_sig)[ncol(LDL_silver_known_sig)] <- "PIP_finemap_with_L=5"

DT::datatable(LDL_silver_known_sig,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Comparing the old results and new results for the silver standard genes'),options = list(pageLength = 10) )
```
```{r warning=F, message=F, fig.height=8, fig.width=12}

print("ABCG8 weights")

weights_single <- readRDS(paste0(folder_single_results,"/",trait,"/",trait,"_",tissue,".preprocessed.weights.E.RDS"))
weights_gene <- weights_single[["ENSG00000143921.6"]]

print(weights_gene)




snp_map <- readRDS("/project2/xinhe/shared_data/multigroup_ctwas/LD_region_info/snp_map.RDS")



finemap_res_single <- ctwas_res_single_post$finemap_res
finemap_res_single <- anno_finemap_res(finemap_res_single,
                                          snp_map = snp_map,
                                          mapping_table = mapping_two,
                                          add_gene_annot = TRUE,
                                          map_by = "molecular_id",
                                          drop_unmapped = TRUE,
                                          add_position = TRUE,
                                          use_gene_pos = "mid")

print("PLTP")
region_id <- "20_44051536_46210417"

make_locusplot(finemap_res_single,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_single,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```

```{r warning=F, message=F, fig.height=8, fig.width=12}

print("ABCA1")
region_id <- "9_104819468_106536473"

make_locusplot(finemap_res_single,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_single,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```
```{r warning=F, message=F, fig.height=8, fig.width=12}

print("NPC1L1")
region_id <- "7_43119475_44724229"

make_locusplot(finemap_res_single,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_single,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```

## Checking why some silver standard genes are missed -- single eQTL, L=5

```{r warning=F, message=F, fig.height=20, fig.width=20}

LDL_silver_known_sig <- LDL_silver_known[as.numeric(LDL_silver_known$PIP) > 0.8 & LDL_silver_known$PIP !="NA",]
LDL_silver_known_sig <- LDL_silver_known_sig[,c("genename","cs_index","PIP","z","num_eqtl","region_tag")]

# check z_scores

z_gene_single_sharedvar_L5 <- readRDS(paste0(folder_single_results_L5,"/",trait,"/",trait,"_",tissue,".z_gene.RDS"))

z_gene_single_sharedvar_L5 <- z_gene_single_sharedvar_L5 %>%
  mutate(molecular_id = sub("\\|.*", "", id)) %>%  # Extract ENSG ID from id
  left_join(mapping_two %>% dplyr::select(molecular_id, gene_name), by = "molecular_id")
z_gene_single_sharedvar_L5 <- z_gene_single_sharedvar_L5[,c("gene_name","z")]

z_gene_selected_L5 <- z_gene_single_sharedvar_L5[z_gene_single_sharedvar_L5$gene_name %in% LDL_silver_known_sig$genename,]

LDL_silver_known_sig <- merge(LDL_silver_known_sig,z_gene_selected_L5, by.x ="genename", by.y = "gene_name",all.x=T)

region_info <- readRDS("/project2/xinhe/shared_data/multigroup_ctwas/LD_region_info/region_info.RDS")

combined_pip_by_group_single_nocs_L5 <- combine_gene_pips(susie_alpha_res_single_post_L5,
                                             group_by = "gene_name",
                                             by = "group",
                                             method = "combine_cs",
                                             filter_cs = F,
                                             include_cs_id = T)

LDL_silver_known_sig <- merge(LDL_silver_known_sig, combined_pip_by_group_single_nocs_L5, by.x = "genename", by.y = "gene_name", all.x = T)

LDL_silver_known_sig <- LDL_silver_known_sig[,c("genename","cs_index","PIP","z.x","z.y","combined_cs_id","combined_pip")]
colnames(LDL_silver_known_sig) <- c("genename","cs_index_old","PIP_old","z_old","z_new","cs_id_new","PIP_new_L=5")

DT::datatable(LDL_silver_known_sig,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Comparing the old results and new results (L=5) for the silver standard genes'),options = list(pageLength = 10) )
```


```{r warning=F, message=F, fig.height=8, fig.width=12}

print("ABCG8 weights")

weights_single_sharedvar_L5 <- readRDS(paste0(folder_single_results_L5,"/",trait,"/",trait,"_",tissue,".preprocessed.weights.E.RDS"))
weights_gene_L5 <- weights_single_sharedvar_L5[["ENSG00000143921.6"]]

print(weights_gene_L5)




snp_map <- readRDS("/project2/xinhe/shared_data/multigroup_ctwas/LD_region_info/snp_map.RDS")



finemap_res_single_sharedvar_L5 <- ctwas_res_single_post_L5$finemap_res
finemap_res_single_sharedvar_L5 <- anno_finemap_res(finemap_res_single_sharedvar_L5,
                                          snp_map = snp_map,
                                          mapping_table = mapping_two,
                                          add_gene_annot = TRUE,
                                          map_by = "molecular_id",
                                          drop_unmapped = TRUE,
                                          add_position = TRUE,
                                          use_gene_pos = "mid")

```

```{r warning=F, message=F, fig.height=8, fig.width=12}

print("NPC1L1")
region_id <- "7_43119475_44724229"

make_locusplot(finemap_res_single_sharedvar_L5,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_single_sharedvar_L5,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```




<!-- ## PIP partition for the top genes -->


<!-- ```{r warning=F, message=F, fig.height=20, fig.width=20} -->

<!-- plot_heatmap_bytissue(heatmap_data = combined_pip_sig_multi, main = "PIP partition for genes with PIP > 0.8 from multi-group analysis",tissues = tissues) -->
<!-- ``` -->


<!-- ```{r warning=F, message=F, fig.height=20, fig.width=20} -->
<!-- plot_heatmap_byomics(heatmap_data = combined_pip_sig_multi, main = "PIP partition for genes with PIP > 0.8 from multi-group analysis") -->
<!-- ``` -->




# Comparing with bystander genes

## Checking the bystander genes -- single eQTL, L=5

```{r warning=F, message=F, fig.height=20, fig.width=20}

LDL_silver_bystand_sig <- LDL_silver_bystand[as.numeric(LDL_silver_bystand$PIP) > 0.8 & LDL_silver_bystand$PIP !="NA",]
LDL_silver_bystand_sig <- LDL_silver_bystand_sig[,c("genename","cs_index","PIP","z","num_eqtl")]

LDL_silver_bystand_sig <- merge(LDL_silver_bystand_sig,z_gene_single_sharedvar_L5, by.x ="genename", by.y = "gene_name",all.x=T)

LDL_silver_bystand_sig <- merge(LDL_silver_bystand_sig, combined_pip_by_group_single_nocs_L5, by.x = "genename", by.y = "gene_name", all.x = T)

LDL_silver_bystand_sig <- LDL_silver_bystand_sig[,c("genename","cs_index","PIP","z.x","z.y","combined_cs_id","combined_pip")]
colnames(LDL_silver_bystand_sig) <- c("genename","cs_index_old","PIP_old","z_old","z_new","cs_id_new","PIP_new_L=5")

DT::datatable(LDL_silver_bystand_sig,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Comparing the old results and new results (L=5) for the bystander genes'),options = list(pageLength = 10) )
```

```{r warning=F, message=F, fig.height=8, fig.width=12}

print("USP1")
region_id <- "1_61456693_62989418"

make_locusplot(finemap_res_single_sharedvar_L5,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_single_sharedvar_L5,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```

## Checking the bystander genes -- single eQTL, pre-estimate L

```{r warning=F, message=F, fig.height=20, fig.width=20}

LDL_silver_bystand_sig <- LDL_silver_bystand[as.numeric(LDL_silver_bystand$PIP) > 0.8 & LDL_silver_bystand$PIP !="NA",]
LDL_silver_bystand_sig <- LDL_silver_bystand_sig[,c("genename","cs_index","PIP","z","num_eqtl")]

LDL_silver_bystand_sig <- merge(LDL_silver_bystand_sig,z_gene_single, by.x ="genename", by.y = "gene_name",all.x=T)

LDL_silver_bystand_sig <- merge(LDL_silver_bystand_sig, combined_pip_by_group_single_nocs, by.x = "genename", by.y = "gene_name", all.x = T)

LDL_silver_bystand_sig <- LDL_silver_bystand_sig[,c("genename","cs_index","PIP","z.x","z.y","combined_cs_id","combined_pip")]
colnames(LDL_silver_bystand_sig) <- c("genename","cs_index_old","PIP_old","z_old","z_new","cs_id_new","PIP_new_preL")

DT::datatable(LDL_silver_bystand_sig,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Comparing the old results and new results (pre-estimate L) for the bystander genes'),options = list(pageLength = 10) )
```

```{r warning=F, message=F, fig.height=8, fig.width=12}

print("USP1")
region_id <- "1_61456693_62989418"

make_locusplot(finemap_res_single,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_single,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```



# Comparing z-score and pip


```{r warning=F, message=F, fig.height=5, fig.width=5}
finemap_res_single_gene <- finemap_res_single[finemap_res_single$type !="SNP",]
ggplot(finemap_res_single_gene, aes(y = susie_pip, x = abs(z))) +
  geom_point(alpha = 0.5, size = 0.5) +  # Adjust alpha and size for better visualization
  labs(x ="|Z|" , y = "SuSiE PIP", title = "single eqtl, pre-estimate L") +
  theme_minimal()
```


```{r warning=F, message=F, fig.height=5, fig.width=5}

finemap_res_single_gene_L5 <- finemap_res_single_sharedvar_L5[finemap_res_single_sharedvar_L5$type !="SNP",]

ggplot(finemap_res_single_gene_L5, aes(y = susie_pip, x = abs(z))) +
  geom_point(alpha = 0.5, size = 0.5) +  # Adjust alpha and size for better visualization
  labs(x ="|Z|" , y = "SuSiE PIP", title = "single eqtl, L=5") +
  theme_minimal()
```
```{r warning=F, message=F, fig.height=5, fig.width=5}

finemap_res_multi <- ctwas_res_multi_post$finemap_res
finemap_res_multi <- anno_finemap_res(finemap_res_multi,
                                          snp_map = snp_map,
                                          mapping_table = mapping_two,
                                          add_gene_annot = TRUE,
                                          map_by = "molecular_id",
                                          drop_unmapped = TRUE,
                                          add_position = TRUE,
                                          use_gene_pos = "mid")

finemap_res_multi_gene <- finemap_res_multi[finemap_res_multi$type !="SNP",]
ggplot(finemap_res_multi_gene, aes(y = susie_pip, x = abs(z))) +
  geom_point(alpha = 0.5, size = 0.5) +  # Adjust alpha and size for better visualization
  labs(x ="|Z|" , y = "SuSiE PIP", title = "multigroup, QTL share variance ,pre-estimate L") +
  theme_minimal()
```

```{r warning=F, message=F, fig.height=8, fig.width=12}

print(finemap_res_multi_gene[finemap_res_multi_gene$susie_pip>0.75 & abs(finemap_res_multi_gene$z) < 3,])

weights_multi <- readRDS(paste0(folder_multi_results,"/",trait,"/",trait,".preprocessed.weights.RDS"))

region_id <- "11_116512631_117876395"

make_locusplot(finemap_res_multi,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_multi,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```

```{r warning=F, message=F, fig.height=8, fig.width=12}

region_id <- "21_39110976_40017600"

make_locusplot(finemap_res_multi,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_multi,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```

No LD mismatch issue detected for the 2 genes above.

```{r warning=F, message=F, fig.height=5, fig.width=5}

finemap_res_multi_samevar <- ctwas_res_multi_post_samevar$finemap_res
finemap_res_multi_samevar <- anno_finemap_res(finemap_res_multi_samevar,
                                          snp_map = snp_map,
                                          mapping_table = mapping_two,
                                          add_gene_annot = TRUE,
                                          map_by = "molecular_id",
                                          drop_unmapped = TRUE,
                                          add_position = TRUE,
                                          use_gene_pos = "mid")

finemap_res_multi_samevar_gene <- finemap_res_multi_samevar[finemap_res_multi_samevar$type !="SNP",]
ggplot(finemap_res_multi_samevar_gene, aes(y = susie_pip, x = abs(z))) +
  geom_point(alpha = 0.5, size = 0.5) +  # Adjust alpha and size for better visualization
  labs(x ="|Z|" , y = "SuSiE PIP", title = "multigroup, all groups share variance, pre-estimate L") +
  theme_minimal()
```




```{r warning=F, message=F, fig.height=5, fig.width=5}

finemap_res_multi_L5 <- ctwas_res_multi_post_L5$finemap_res
finemap_res_multi_L5 <- anno_finemap_res(finemap_res_multi_L5,
                                          snp_map = snp_map,
                                          mapping_table = mapping_two,
                                          add_gene_annot = TRUE,
                                          map_by = "molecular_id",
                                          drop_unmapped = TRUE,
                                          add_position = TRUE,
                                          use_gene_pos = "mid")

finemap_res_multi_L5_gene <- finemap_res_multi_L5[finemap_res_multi_L5$type !="SNP",]
ggplot(finemap_res_multi_L5_gene, aes(y = susie_pip, x = abs(z))) +
  geom_point(alpha = 0.5, size = 0.5) +  # Adjust alpha and size for better visualization
  labs(x ="|Z|" , y = "SuSiE PIP", title = "multigroup, all groups share variance, L = 5") +
  theme_minimal()
```


```{r warning=F, message=F, fig.height=8, fig.width=12}

print(finemap_res_multi_L5_gene[finemap_res_multi_L5_gene$susie_pip>0.75 & abs(finemap_res_multi_L5_gene$z) < 3,])

weights_multi_L5 <- readRDS(paste0(folder_multi_results_L5,"/",trait,"/",trait,".preprocessed.weights.RDS"))

region_id <- "2_117609890_120546207"

make_locusplot(finemap_res_multi_L5,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_multi_L5,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))



```


```{r warning=F, message=F, fig.height=8, fig.width=12}

print(finemap_res_multi_L5_gene[finemap_res_multi_L5_gene$susie_pip>0.75 & abs(finemap_res_multi_L5_gene$z) < 3,])

weights_multi_L5 <- readRDS(paste0(folder_multi_results_L5,"/",trait,"/",trait,".preprocessed.weights.RDS"))

region_id <- "11_116512631_117876395"

make_locusplot(finemap_res_multi_L5,
               region_id = region_id,
               ens_db = ens_db,
               weights = weights_multi_L5,
               highlight_pip = 0.8,
               filter_protein_coding_genes = TRUE,
               filter_cs = TRUE,
               color_pval_by = "cs",
               color_pip_by = "cs",panel.heights = c(4,4,1,1))

```
LD mismatch checked, no LD mismatch issue for these two genes.

# Comparing the results for multi-group analysis

```{r warning=F, message=F, fig.height=5, fig.width=5}

venn.plot <- venn.diagram(
  x = list(Group1 = combined_pip_sig_multi$gene_name, Group2 = combined_pip_sig_multi_samevar$gene_name, Group3 = combined_pip_sig_multi_L5$gene_name, Group4 = combined_pip_sig_multi_samevar_L5$gene_name),
  filename = NULL,
  output = FALSE,
  fill = c("skyblue", "pink", "lightgreen","yellow"),
  alpha = 0.5,
  category.names = c("share_type,preL", "share_all,preL", "share_type,L=5","share_all,L=5"),
  main = "Combined PIP > 0.8, LDL"
)

grid.draw(venn.plot)

```


<!-- 14 Unique genes identified by "share_all L=5" settings -->
<!-- ```{r warning=F, message=F, fig.height=5, fig.width=5} -->
<!-- print(setdiff(combined_pip_sig_multi_L5$gene_name, union(combined_pip_sig_multi$gene_name, combined_pip_sig_multi_samevar$gene_name))) -->
<!-- ``` -->

<!-- Notes from deepseek:  -->

<!-- - The strongest direct links to LDL metabolism are PLTP, KIF13B, SGMS1, and CCDC93.  -->
<!-- - CTSB and POR have more indirect associations.  -->
<!-- - The remaining genes (e.g., ABHD6, MYO9B) lack well-established connections to LDL in current literature. Further research may clarify their roles. -->


<!-- 1 Unique genes identified by "share_all preL" settings -->
<!-- ```{r warning=F, message=F, fig.height=5, fig.width=5} -->
<!-- print(setdiff(combined_pip_sig_multi_samevar$gene_name, union(combined_pip_sig_multi$gene_name, combined_pip_sig_multi_L5$gene_name))) -->
<!-- ``` -->

<!-- Notes from deepseek:  -->

<!-- SEPT2 is unlikely to play a direct role in LDL metabolism but could modulate cellular pathways (e.g., membrane trafficking, cytoskeletal organization) that indirectly intersect with LDL receptor function or cholesterol homeostasis -->



<!-- 5 Unique genes identified by "share_type, preL" settings -->
<!-- ```{r warning=F, message=F, fig.height=5, fig.width=5} -->
<!-- print(setdiff(combined_pip_sig_multi$gene_name, union(combined_pip_sig_multi_samevar$gene_name, combined_pip_sig_multi_L5$gene_name))) -->
<!-- ``` -->

<!-- Notes from deepseek:  -->

<!-- - PCSK9 and SNX17 are directly involved in LDL-C regulation via LDLR trafficking. -->
<!-- - BUD13 and PSMG1 have genetic associations with LDL-C but lack mechanistic clarity. -->
<!-- - ZGPAT has minimal evidence for LDL links but may influence broader lipid pathways. -->


# Comparing the GO enrichment results for multi-group analysis

## Comparing multi-group: share_type,preL and share_all,L=5

```{r fig.height=5, fig.width=5, message=FALSE, warning=FALSE}

trait <- "LDL-ukb-d-30780_irnt"
db <- "GO_Biological_Process_2023"

enrich_multi <- readRDS(paste0("/project/xinhe/xsun/multi_group_ctwas/13.post_processing_0103/results_downstream/enrich_fractional/enrichment_fractional_calibrated_blgeneset_summary_multigroup_", trait, "_", db, ".RDS"))
enrich_multi_samevarL5 <- readRDS(paste0("/project/xinhe/xsun/multi_group_ctwas/13.post_processing_0103/results_downstream/enrich_fractional/enrichment_fractional_calibrated_blgeneset_summary_multigroup_samevar_L5_", trait, "_", db, ".RDS"))

print("FDR_adjust < 0.05")

enrich_multi_sig <- enrich_multi[enrich_multi$fdr_calibrated < 0.05,]
enrich_multi_samevarL5_sig <- enrich_multi_samevarL5[enrich_multi_samevarL5$fdr_calibrated < 0.05,]

venn.plot <- venn.diagram(
  x = list(Group1 = enrich_multi_sig$G, Group2 = enrich_multi_samevarL5_sig$GO),
  filename = NULL,  
  output = FALSE,   
  fill = c("skyblue", "pink"),
  alpha = 0.5,
  category.names = c("share_type,preL", "share_all,L=5"),
  main = "Comparing GO terms identified by fractional model, FDR < 0.05"
)

grid.draw(venn.plot)
```

```{r fig.height=5, fig.width=5, message=FALSE, warning=FALSE}
print("FDR_adjust < 0.1")

enrich_multi_sig <- enrich_multi[enrich_multi$fdr_calibrated < 0.1,]
enrich_multi_samevarL5_sig <- enrich_multi_samevarL5[enrich_multi_samevarL5$fdr_calibrated < 0.1,]

venn.plot <- venn.diagram(
  x = list(Group1 = enrich_multi_sig$G, Group2 = enrich_multi_samevarL5_sig$GO),
  filename = NULL,  
  output = FALSE,   
  fill = c("skyblue", "pink"),
  alpha = 0.5,
  category.names = c("share_type,preL", "share_all,L=5"),
  main = "Comparing GO terms identified by fractional model, FDR < 0.1"
)

grid.draw(venn.plot)


enrich_multi_unique <- enrich_multi_samevarL5_sig[!enrich_multi_samevarL5_sig$GO %in% enrich_multi_sig$GO,]
enrich_multi_unique <- cbind(enrich_multi_unique$GO,enrich_multi_unique[,1:ncol(enrich_multi_unique)-1])
DT::datatable(enrich_multi_unique,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Enrichment results -- unique GO terms found by share_all,L=5'),options = list(pageLength = 10) )

# enrich_single_unique <- enrich_single_sig[!enrich_single_sig$GO %in% enrich_multi_sig$GO,]
# DT::datatable(enrich_single_unique,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Enrichment results -- unique GO terms found by single-group analysis, FDR < 0.05'),options = list(pageLength = 10) )
```


Among these 

The Gene Ontology terms related to LDL (Low-Density Lipoprotein) are:

- Positive Regulation Of Cholesterol Transport (GO:0032376) : LDL is directly involved in cholesterol transport in the bloodstream.
- Very-Low-Density Lipoprotein Particle Assembly (GO:0034379): VLDL is a precursor to LDL during lipid metabolism.

```{r fig.height=5, fig.width=5, message=FALSE, warning=FALSE}
enrich_multi_unique <- enrich_multi_sig[!enrich_multi_sig$GO %in% enrich_multi_samevarL5_sig$GO,]
enrich_multi_unique <- cbind(enrich_multi_unique$GO,enrich_multi_unique[,1:ncol(enrich_multi_unique)-1])
DT::datatable(enrich_multi_unique,caption = htmltools::tags$caption( style = 'caption-side: left; text-align: left; color:black;  font-size:150% ;','Enrichment results -- unique GO terms found by share_all,L=5'),options = list(pageLength = 10) )
```

Among these 

The Gene Ontology terms related to LDL (Low-Density Lipoprotein) from this list are:

- Negative Regulation Of Lipoprotein Particle Clearance: Directly involves lipoprotein particles like LDL, as it regulates their removal from the bloodstream.
- Regulation Of Low-Density Lipoprotein Particle Clearance: Explicitly mentions LDL particle clearance, a key process in LDL metabolism.
- Regulation Of Receptor Recycling (GO:0001919): Likely connected to LDL receptor recycling, which modulates LDL uptake into cells.